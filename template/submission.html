<!--Main layout-->
<div class="container">
    <!--Header row-->
    <div class="row">
        <div class="col-md-12">
            <div class="jumbotron">
                <h2 class="h2-responsive">Submissions for Annual Conference</h2>
                <br/>
                <p class="lead">Submissions for the 2020 annual conference (i.e., posters) can be submitted through our online form. The information necessary to submit is provided below.</p>

                <p>Students may choose to be considered for inclusion as a <b>SQAB 2020 Tony Nevin Student Presenter</b>. If interested, you will need to (1) confirm this in your submission and (2) upload your CV and a letter of recommendation using a link that will be included in your submission confirmation email.</p>

                <p>Once all areas are completed, please press the Submit button once to finalize the submission.</p>

                <p class="lead"><strong>Poster submissions are due before Friday April 3, 2020 (midnight, Pacific).</strong></p>
                <p class="lead" id="countdownTimer" style="font-weight: bold;">Time Remaining: ...</p>
            </div>
        </div>
    </div>
    <!--/.Header row-->

    <!--Information row-->
    <div class="row">
        <!--Featured images-->
        <div class="col-md-6">
            <div class="well">
                <div id="myCarousel" class="carousel slide" data-ride="carousel">
                    <!-- Indicators -->
                    <ol class="carousel-indicators">
                        <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
                        <li data-target="#myCarousel" data-slide-to="1"></li>
                        <li data-target="#myCarousel" data-slide-to="2"></li>
                        <li data-target="#myCarousel" data-slide-to="3"></li>
                        <li data-target="#myCarousel" data-slide-to="4"></li>
                    </ol>

                    <!-- Wrapper for slides -->
                    <div class="carousel-inner">
                        <div class="item active"><img class="d-block w-100" src="img/symp-5.jpeg" alt=""></div>
                        <div class="item"><img class="d-block w-100" src="img/symp-2.jpeg" alt="Second slide"></div>
                        <div class="item"><img class="d-block w-100" src="img/symp-3.jpeg" alt="Second slide"></div>
                        <div class="item"><img class="d-block w-100" src="img/symp-4.jpeg" alt="Second slide"></div>
                        <div class="item"><img class="d-block w-100" src="img/symp-1.jpeg" alt="Second slide"></div>
                    </div>

                    <!-- Left and right controls -->
                    <a class="left carousel-control" href="#myCarousel" data-slide="prev">
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="right carousel-control" href="#myCarousel" data-slide="next">
                        <span class="sr-only">Next</span>
                    </a>
                </div>
            </div>
        </div>
        <!--Featured images-->

        <div class="col-md-6">
            <div id="submitPanel" class="well">
                <h2 class="h2-responsive">Submission for SQAB 2020</h2>
                <form>
                    <div class="form-group">
                        <label htmlFor="submittingAuthor" class="bmd-label-floating">Submitting Author:</label>
                        <input name="submittingAuthor" type="text"
                            class="form-control"
                            placeholder="Firstname Lastname" />
                    </div>

                    <div class="form-group">
                        <label htmlFor="posterTitle" class="bmd-label-floating">Poster Title:</label>
                        <input name="posterTitle" type="text"
                            class="form-control"
                            placeholder="Experimental comparison of..." />
                    </div>

                    <div class="form-group">
                        <label htmlFor="authorEmail" class="bmd-label-floating">Corresponding Email:</label>
                        <input name="authorEmail" type="text"
                            placeholder="presenter@company.com"
                            class="form-control" />
                    </div>

                    <div class="form-group">
                        <label htmlFor="abstractText" class="bmd-label-floating">Abstract (Maximum 300 words):</label>
                        <textarea name="abstractText"
                            placeholder="In this study..."
                            class="form-control"
                            rows="10" />
                    </div>

                    <div class="form-group">
                        <label htmlFor="authorList" class="bmd-label-floating">Full Author List, with Affiliation (One per line, please):</label>
                        <textarea name="authorList"
                            placeholder="Firstname Lastname (XYZ University)"
                            class="form-control"
                            rows="5" />
                    </div>

                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="studentPresenter">
                        <label class="form-check-label" for="studentPresenter">I am interested in being a Tony Nevin Student Presenter.</label>
                    </div>

                    <a href="javascript: uploadPoster()"
                       id="submitBtn"
                       class="btn btn-primary btn-block btn-raised">Submit</a>
                </form>
            </div>
        </div>
    </div>
    <!--/.Information row-->
</div>

<script>
  var config = {
    apiKey: "AIzaSyAoIBtOT5wcVNP3ujWILYbsWfvvzWYgth0",
    authDomain: "sqabbackend.firebaseapp.com",
    databaseURL: "https://sqabbackend.firebaseio.com",
    projectId: "sqabbackend",
    storageBucket: "sqabbackend.appspot.com",
    messagingSenderId: "680112495974"
  };

  firebase.initializeApp(config);

  $('#studentPresenter').prop('checked', true);

  setInterval(function() { 
    if (isSubmissionPortalClosed) {
        document.getElementById("countdownTimer").innerText = "---";

        return;
    }

    var t = Date.parse('April 3 2020 23:59:59 GMT-0700') - Date.parse(new Date());
    var seconds = Math.floor( (t/1000) % 60 );
    var minutes = Math.floor( (t/1000/60) % 60 );
    var hours =   Math.floor( (t/(1000*60*60)) % 24 );
    var days =    Math.floor(  t/(1000*60*60*24) );

    var strOutput = "Time Remaining: " + days + " days, " + 
                                         hours + " hours, " + 
                                         minutes + " minutes, " + 
                                         seconds + " seconds";
 
    document.getElementById("countdownTimer").innerText = strOutput;

    checkTime();
  }, 1000);

  function checkTime() {
    if (isSubmissionPortalClosed) {
        return;
    }

    var pstOffset = -7;
    var currLocationDate = new Date();
    var utcDate = currLocationDate.getTime() + (currLocationDate.getTimezoneOffset() * 60000);
    var offsetDate = new Date(utcDate + (3600000*pstOffset));

    if (offsetDate.getMonth() + 1 >= 4 &&
        offsetDate.getDate() >= 6 &&
        offsetDate.getFullYear() >= 2020) {

        var subPanel = document.getElementById("submitPanel");
        subPanel.innerHTML = "";      

        var closedElement = document.createElement("h2");
        closedElement.innerText = "Submission for SQAB 2020";
        closedElement.className = "h2-responsive";
        subPanel.appendChild(closedElement);

        var closedTag = document.createElement("p");
        closedTag.innerText = "The window for submissions to SQAB 2020 have closed.";
        closedTag.className = "lead";
        subPanel.appendChild(closedTag);

        isSubmissionPortalClosed = true;
    }
  }

  var isSubmissionPortalClosed = false;

  checkTime();
</script>

<script>
function validateEmail(emailAddressString) {
    var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    return re.test(emailAddressString.toLowerCase());
}

function uploadPoster() {
    var submittingAuthor = document.getElementsByName("submittingAuthor")[0].value;
    var authorEmail = document.getElementsByName("authorEmail")[0].value;
    var posterTitle = document.getElementsByName("posterTitle")[0].value;
    var abstractText = document.getElementsByName("abstractText")[0].value;
    var authorList = document.getElementsByName("authorList")[0].value;

    if ((submittingAuthor.split( /\w\w+/ ).length - 1 ) < 2 ) {
        alert( 'Please enter a full name (i.e., First and Last)!' );
        return;
    }
    else if ((posterTitle.split( /\w\w+/ ).length - 1 ) < 2 ) {
        alert( 'Please enter a full title (i.e., 3+ Words)!' );
        return;
    }
    else if (!validateEmail(authorEmail)) {
        alert( 'Check email address in form (i.e., ***@***.***)!' );
        return;
    }
    else if ((abstractText.split( /\w\w+/ ).length - 1 ) > 300 ) {
        alert( 'Abstract is too long (i.e., over 300 words)!' );
        return;
    }

    var currentdate = new Date();
    var datetime = ""
        + ( currentdate.getMonth() + 1 ) + "/"
        + currentdate.getDate() + "/"
        + currentdate.getFullYear() + " @ "
        + currentdate.getHours() + ":"
        + currentdate.getMinutes() + ":"
        + currentdate.getSeconds();

    var willingPresenter = $('#studentPresenter').prop('checked') == true;

    var data = {
        name:      submittingAuthor,
        title:     posterTitle,
        email:     authorEmail,
        abstract:  abstractText,
        list:      authorList,
        time:      datetime,
        presenter: willingPresenter
    }; 

    const dbRef = firebase.database().ref();
    const postersRef = dbRef.child('SQAB2020');

    postersRef.push(data, function(error) {
        if (error) {
            alert( 'Your submission could not be completed. Please try again later.' );
        } else {
            document.getElementById("submitBtn").href = "#";
            document.getElementById("submitBtn").text = "Successfully Submitted";
            document.getElementById("submitBtn").className += " disabled";

            alert( 'Successfully Submitted! If interested in being a Tony Nevin student presenter, please upload your CV and a letter of recommendation using the link supplied in the confirmation email.' );
        }
    });
}
</script>
